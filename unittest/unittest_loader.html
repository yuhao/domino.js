<html>
<head>
  <link rel="import" href="/ticket.js/core/ticket.html">
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="/ticket.js/third_party/chai.js"></script>
<body>
  <h1 id="test">Unittest</h1>
  <div id="dashboard">
  </div>
</body>

<script>
  var assert = chai.assert;
  var unittest_suite = [];

  function test(name, func) {
    unittest_suite[name] = func;
  }
</script>

<link rel="import" href="/ticket.js/unittest/document_prop_test.html">
<link rel="import" href="/ticket.js/unittest/document_method_test.html">
<link rel="import" href="/ticket.js/unittest/proxy_test.html">
<link rel="import" href="/ticket.js/unittest/window_test.html">

<script id="test_runner">
  var duration, success;
  var testName, currentTest, result;
  var unittests = Object.keys(unittest_suite);
  var dashboard = document.getElementById("dashboard");
  var div, link, span, text;

  function tryOneTest(currentTest) {
    var start = new Date();
    var success;
    try {
      currentTest();
      success = true;
    }
    catch (e) {
      console.log(e)
      success = false;
    }
    var end = new Date();

    return {success: success, duration: end - start};
  }

  function linkOnclick(testFunc, span, text) {
    return function() {
      var result = tryOneTest(testFunc);
      var success = result.success;
      var duration = result.duration;
      span.style.color = (success === true) ? "darkgreen" : "red";
      text.nodeValue = (success === true) ? " Passed" + " (" + duration.toString() + " ms)" : " Failed" + " (" + duration.toString() + " ms)";
    }
  }

  for (var i = 0; i < unittests.length; i++) {
    testName = unittests[i];
    currentTest = unittest_suite[testName];

    result = tryOneTest(currentTest);
    duration = result.duration;
    success = result.success;

    div = document.createElement("div");
    link = document.createElement("a");
    span = document.createElement("span");
    text = document.createTextNode("");

    text.nodeValue = (success === true) ? " Passed" + " (" + duration.toString() + " ms)" : " Failed" + " (" + duration.toString() + " ms)";
    link.href = "javascript:void(0);";
    link.text = testName;
    link.onclick = linkOnclick(currentTest, span, text);

    span.style.fontWeight = "bold"
    span.style.color = (success === true) ? "darkgreen" : "red";

    // <div>
    //   <a href="#">unittest Id</a> <span>pass|fail</span>
    // </div>
    div.appendChild(link);
    div.appendChild(span);
    span.appendChild(text);
    dashboard.appendChild(div);
  }
</script>

</html>

